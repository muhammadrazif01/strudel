<html>
    <head>
        <title>Menu</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <style>
        .plus-minus-input {
        -webkit-align-items: center;
            -ms-flex-align: center;
                align-items: center;
        }

        .plus-minus-input .input-group-field {
        text-align: center;
        margin-left: 0.5rem;
        margin-right: 0.5rem;
        padding: 1rem;
        }

        .plus-minus-input .input-group-field::-webkit-inner-spin-button,
        .plus-minus-input .input-group-field ::-webkit-outer-spin-button {
        -webkit-appearance: none;
                appearance: none;
        }

        .plus-minus-input .input-group-button .circle {
        border-radius: 50%;
        padding: 0.25em 0.8em;
        }
        </style>
    </head>
    <body>
        <h1>{{menu}}</h1>
        <br>
            <table>
                <thead>
                <tr>
                    <th>Makanan/Minuman</th>
                    <th>Harga</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                {% for fnb in menus %}
                <tr>
                    <td>{{ fnb.name }}</td>
                    <td>{{ fnb.price }}</td>
                    <td>
                        <!-- Change the `data-field` of buttons and `name` of input field's for multiple plus minus buttons-->
                        <div class="input-group plus-minus-input">
                            <div class="input-group-button">
                            <button type="button" class="button hollow circle" data-quantity="minus" data-field="{{fnb.id}}">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                            </button>
                            </div>
                            <input class="input-group-field fnb-choice" type="number" name="{{fnb.id}}" value="0">
                            <div class="input-group-button">
                            <button type="button" class="button hollow circle" data-quantity="plus" data-field="{{fnb.id}}">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button type="button" id="see-summary">
                Order
            </button>
        <script>
            $(document).ready(function(){
                // This button will increment the value
                $('[data-quantity="plus"]').click(function(e){

                    // Stop acting like a button
                    e.preventDefault();
                    // Get the field name
                    fieldName = $(this).attr('data-field');
                    // Get its current value
                    var currentVal = parseInt($('input[name='+fieldName+']').val());
                    // If is not undefined
                    if (!isNaN(currentVal)) {
                        // Increment
                        $('input[name='+fieldName+']').val(currentVal + 1);
                    } else {
                        // Otherwise put a 0 there
                        $('input[name='+fieldName+']').val(0);
                    }
                });

                // This button will decrement the value till 0
                $('[data-quantity="minus"]').click(function(e) {
                    // Stop acting like a button
                    e.preventDefault();
                    // Get the field name
                    fieldName = $(this).attr('data-field');
                    // Get its current value
                    var currentVal = parseInt($('input[name='+fieldName+']').val());
                    // If it isn't undefined or its greater than 0
                    if (!isNaN(currentVal) && currentVal > 0) {
                        // Decrement one
                        $('input[name='+fieldName+']').val(currentVal - 1);
                    } else {
                        // Otherwise put a 0 there
                        $('input[name='+fieldName+']').val(0);
                    }
                });

                var summary_button = document.getElementById("see-summary")
                summary_button.addEventListener('click', createOrder) 

            });
            function createOrder() {
                const selected = document.getElementsByClassName("fnb-choice")
                var fnb_choices = {}
                for (var i = 0; i < selected.length; i++) {
                    if(selected[i].value != 0) {
                        fnb_choices[parseInt(selected[i].name)] = selected[i].value
                    }
                }
                fnb_choices['reservation_id'] = '{{reservation_id}}'
                $.ajax({
                    url: "{% url 'order:create_order' %}",
                    type: 'POST',
                    contentType: "application/json; charset=utf-8", 
                    data: JSON.stringify(fnb_choices),
                    success: function(order_id) {
                        if (order_id != 'None') {
                            alert('Order created, redirecting to order details')
                            window.location.href = "/order/detail/" + order_id
                        }
                        else {
                            alert('Order failed, please try again')
                        }

                    }
                });
            }
        </script>
    </body>
</html>