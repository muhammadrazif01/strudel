<html><!DOCTYPE html>
<head>
  <Title>Order Detail</Title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</head>
<body>
  <h1>Order Confirmation</h1>
  <br>
<table>
    <tr>
        <td>Order at {{restaurant}} details:</td>
    </tr>
    {% for fnb in fnbchoices %}
    <tr>
        <td>{{fnb}}</td>
    </tr>
    {% endfor %}
    <tr>
        <th>Subtotal:</th>
        <td>{{total_price}}</td>
    </tr>
    <tr>
        <th>Status:</th>
        <td>{{status}}</td>
    </tr>
    <tr>
        <th>Payment Method:</th>
        <td>{{payment_method}}</td>
    </tr>
</table>
<button id="go-back">Home</button>
{% if status == "Waiting for payment" %}
<button onclick="pay(this.value)" value="{{id}}">Make payment</button>
{% elif status == "Waiting for restaurant's confirmation" %}
<button onclick="cancel(this.value)" value="{{id}}">Cancel order</button>
{% elif status == "Order confirmed" %}
<button onclick="cancel(this.value)" value="{{id}}">Request cancel</button>
{% endif %}
<script>
    document.getElementById('go-back').onclick = function () {
        window.location.href = '/order'
    }

    function cancel(order_id) {
      if ( confirm("Are you sure you want to cancel this order ?") ) {
        $.ajax({
          url: "/order/cancel/" + order_id,
          type: 'POST',
          success: function(order_id) {
              if (order_id != 'None') {
                  location.reload()
              }
              else {
                  alert('Cancellation failed, please try again')
              }
          }
        });
      }
    }

    function pay(order_id) {
        window.location.href = '/order/pay/' + order_id
    }
</script>
</body>